<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧型英文單字抽查</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 設定 Inter 字體與自訂樣式 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+TC:wght@400;700&display=swap');
        :root {
            /* 顏色變數 */
            --bg-color: #CAC6BD;
            --btn-color: #BB9A88;
            --quiz-color: #979D6E; /* 題目背景色 */
            --correct-color: #F46464; /* 正確答案顏色 */
            --incorrect-color: #B5CEBA; /* 錯誤答案顏色 */
            --skip-color: #F99769; /* 跳過答案顏色 */
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-custom {
            background-color: var(--btn-color);
        }
        .btn-custom:hover {
            background-color: #a48777; 
        }
        .quiz-card-theme {
            background-color: var(--quiz-color);
            border-color: var(--quiz-color); 
        }
        .correct-feedback-bg { background-color: var(--correct-color); }
        .correct-feedback-text { color: var(--correct-color); }
        .incorrect-feedback-bg { background-color: var(--incorrect-color); }
        .incorrect-feedback-text { color: var(--incorrect-color); }
        .skip-feedback-bg { background-color: var(--skip-color); }
        .skip-feedback-text { color: var(--skip-color); }
    </style>
</head>
<body class="p-4">

    <!-- 主容器 -->
    <div class="w-full max-w-lg mx-auto bg-white shadow-2xl rounded-3xl p-6 sm:p-10 border-t-8 border-quiz-card-theme">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">智慧型單字抽查挑戰</h1>
        <p class="text-sm text-gray-500 mb-6 text-center">純離線模式，無法儲存進度。</p>

        <!-- 總分數與進度 -->
        <div class="flex justify-between items-center text-lg font-semibold text-gray-700 mb-6 p-3 bg-gray-50 rounded-xl shadow-inner">
            <span>分數：<span id="score-display" class="text-blue-600">0</span></span>
            <span>總題數：<span id="total-questions-display" class="text-blue-600">0</span></span>
        </div>

        <!-- 測驗卡片區 -->
        <div id="quiz-card" class="h-48 flex flex-col justify-center items-center text-white rounded-2xl p-6 shadow-xl border-4 border-quiz-card-theme transition duration-300 quiz-card-theme">
            <p id="quiz-direction" class="text-sm opacity-80 mb-2"></p>
            <p id="quiz-question" class="text-4xl font-bold leading-snug text-center">Loading...</p>
        </div>

        <!-- 正確答案顯示區 -->
        <div id="correct-answer-display" class="text-center text-xl font-bold mt-4 p-3 bg-yellow-50 text-gray-800 rounded-xl border border-yellow-300 hidden">
            <!-- 答案將顯示在這裡 -->
        </div>

        <!-- 輸入與操作區 -->
        <div class="mt-6">
            <input type="text" id="answer-input"
                   class="w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-400 focus:border-blue-400 transition duration-150 shadow-md text-lg"
                   placeholder="輸入您的答案..."
                   autocomplete="off">

            <!-- 答案反饋區 -->
            <div id="feedback-message" class="text-center font-bold text-lg mt-4 hidden"></div>

            <div class="flex space-x-4 mt-4">
                <button id="submit-button"
                        class="flex-1 btn-custom text-white font-medium py-3 rounded-xl transition duration-150 ease-in-out shadow-lg transform hover:scale-[1.01] active:scale-[0.99]"
                        onclick="handleSubmitOrSkip()">
                    送出
                </button>
                
                <button id="next-button"
                        class="flex-1 btn-custom text-white font-medium py-3 rounded-xl transition duration-150 ease-in-out shadow-lg transform hover:scale-[1.01] active:scale-[0.99] hidden"
                        onclick="nextQuestion()">
                    下一題
                </button>
            </div>
            <p id="user-id-display" class="text-xs text-gray-400 mt-4 text-center break-words">User ID: N/A</p>
        </div>
    </div>

    <!-- JavaScript 邏輯區塊 -->
    <script>
        // 核心單字庫
        const BASE_VOCABULARY = [
            { word: "apple", meaning: "蘋果", pos: "(n.)" },
            { word: "book", meaning: "書本", pos: "(n.)" },
            { word: "house", meaning: "房子", pos: "(n.)" },
            { word: "run", meaning: "跑", pos: "(v.)" },
            { word: "happy", meaning: "快樂的", pos: "(adj.)" },
            { word: "tree", meaning: "樹", pos: "(n.)" },
            { word: "water", meaning: "水", pos: "(n.)" },
            { word: "time", meaning: "時間", pos: "(n.)" },
            { word: "family", meaning: "家庭", pos: "(n.)" },
            { word: "understand", meaning: "理解", pos: "(v.)" },
            { word: "computer", meaning: "電腦", pos: "(n.)" },
            { word: "science", meaning: "科學", pos: "(n.)" },
            { word: "music", meaning: "音樂", pos: "(n.)" },
            { word: "travel", meaning: "旅行", pos: "(v.)" },
            { word: "beautiful", meaning: "美麗的", pos: "(adj.)" },
            { word: "develop", meaning: "發展", pos: "(v.)" },
            { word: "success", meaning: "成功", pos: "(n.)" },
            { word: "system", meaning: "系統", pos: "(n.)" },
            { word: "example", meaning: "範例", pos: "(n.)" },
            { word: "global", meaning: "全球的", pos: "(adj.)" },
            { word: "knowledge", meaning: "知識", pos: "(n.)" },
            { word: "important", meaning: "重要的", pos: "(adj.)" },
            { word: "language", meaning: "語言", pos: "(n.)" },
            { word: "believe", meaning: "相信", pos: "(v.)" },
            { word: "difference", meaning: "差異", pos: "(n.)" },
        ];

        // --- 應用程式狀態 (純離線) ---
        let currentWord = null;
        let currentDirection = ''; 
        let score = 0;
        let totalQuestions = 0;
        let isQuestionAnswered = false;
        
        // 儲存所有單字及其學習統計 (簡化版，無權重，純隨機)
        let fullVocabularyStats = BASE_VOCABULARY; 

        // --- UI 元素 ---
        const questionDisplay = document.getElementById('quiz-question');
        const directionDisplay = document.getElementById('quiz-direction');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');
        const nextButton = document.getElementById('next-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const scoreDisplay = document.getElementById('score-display');
        const totalQuestionsDisplay = document.getElementById('total-questions-display');
        const quizCard = document.getElementById('quiz-card');
        const answerDisplay = document.getElementById('correct-answer-display');
        const userIdDisplay = document.getElementById('user-id-display');

        /**
         * 應用程式啟動，直接載入單字
         */
        function initApp() {
            // 由於這是純離線模式，我們直接從內建單字庫開始
            if (fullVocabularyStats.length > 0) {
                selectNextQuestion(); 
                setupListeners();
                userIdDisplay.textContent = 'User ID: OFFLINE_MODE (無法儲存紀錄)';
            } else {
                questionDisplay.textContent = "單字庫為空，無法開始測驗。";
                directionDisplay.textContent = "Error";
            }
        }

        /**
         * 選擇下一題的單字與抽查方向 (純隨機)
         */
        function selectNextQuestion() {
            if (fullVocabularyStats.length === 0) return;

            // 1. 隨機選取單字
            const randomIndex = Math.floor(Math.random() * fullVocabularyStats.length);
            currentWord = fullVocabularyStats[randomIndex];

            // 2. 隨機決定方向 (英翻中 E2C, 中翻英 C2E)
            currentDirection = Math.random() < 0.5 ? 'E2C' : 'C2E';

            // 3. 渲染題目並重設 UI 狀態
            renderQuestion(currentWord);

            answerInput.value = '';
            answerInput.disabled = false;
            submitButton.disabled = false;
            submitButton.classList.remove('hidden');
            nextButton.classList.add('hidden');
            feedbackMessage.classList.add('hidden');
            answerDisplay.classList.add('hidden');
            quizCard.classList.remove('correct-feedback-bg', 'incorrect-feedback-bg', 'skip-feedback-bg'); 
            quizCard.classList.add('quiz-card-theme'); 
            isQuestionAnswered = false;
            
            answerInput.focus();
        }

        /**
         * 渲染當前題目到畫面上
         */
        function renderQuestion(wordObject) {
            const posDisplay = wordObject.pos ? `<span class="text-2xl opacity-80 font-normal">${wordObject.pos}</span>` : '';
            const currentDirectionText = currentDirection === 'E2C' ? '【英翻中】' : '【中翻英】';
            
            if (currentDirection === 'E2C') {
                directionDisplay.textContent = currentDirectionText;
                questionDisplay.innerHTML = `${wordObject.word} ${posDisplay}`; 
                answerInput.placeholder = '請輸入中文解釋...';
            } else {
                directionDisplay.textContent = currentDirectionText; 
                questionDisplay.innerHTML = `${wordObject.meaning} ${posDisplay}`; 
                answerInput.placeholder = '請輸入英文單字...';
            }
        }

        /**
         * 處理 送出答案 / 跳過 邏輯
         */
        window.handleSubmitOrSkip = function() {
            if (isQuestionAnswered) return;

            const userAnswer = answerInput.value.trim();
            const currentWordStat = currentWord;
            let correctAnswer;

            if (currentDirection === 'E2C') {
                correctAnswer = currentWordStat.meaning; 
            } else {
                correctAnswer = currentWordStat.word;    
            }

            const isSkipped = userAnswer === '';
            const isCorrect = validateAnswer(userAnswer, correctAnswer, currentDirection);

            totalQuestions++;
            totalQuestionsDisplay.textContent = totalQuestions;
            isQuestionAnswered = true;
            answerInput.disabled = true;
            submitButton.classList.add('hidden');
            nextButton.classList.remove('hidden');
            feedbackMessage.classList.remove('hidden');
            answerDisplay.classList.remove('hidden');
            quizCard.classList.remove('quiz-card-theme');


            if (isSkipped) {
                // 跳過邏輯
                feedbackMessage.textContent = '⏭️ 已跳過，請看下方正確答案。';
                feedbackMessage.classList.remove('correct-feedback-text', 'incorrect-feedback-text'); 
                feedbackMessage.classList.add('skip-feedback-text');
                quizCard.classList.add('skip-feedback-bg');
            } else if (isCorrect) {
                // 答對邏輯
                score++;
                scoreDisplay.textContent = score;
                feedbackMessage.textContent = '✅ 太棒了，答案正確！';
                feedbackMessage.classList.remove('incorrect-feedback-text', 'skip-feedback-text');
                feedbackMessage.classList.add('correct-feedback-text'); 
                quizCard.classList.add('correct-feedback-bg'); 
            } else {
                // 答錯邏輯
                feedbackMessage.textContent = '❌ 錯誤！請看下方正確答案。';
                feedbackMessage.classList.remove('correct-feedback-text', 'skip-feedback-text');
                feedbackMessage.classList.add('incorrect-feedback-text');
                quizCard.classList.add('incorrect-feedback-bg');
            }

            // 顯示正確答案
            const correctPOS = currentWordStat.pos;
            answerDisplay.innerHTML = `正確答案：<span class="font-black">${correctAnswer}</span> <span class="text-base font-normal opacity-70">${correctPOS}</span>`;

            answerInput.focus();
        }

        /**
         * 進行下一題
         */
        window.nextQuestion = function() {
            selectNextQuestion();
        }

        /**
         * 答案驗證邏輯
         */
        function validateAnswer(user, correct, direction) {
            if (direction === 'C2E') {
                // 英文：不分大小寫
                return user.toLowerCase() === correct.toLowerCase();
            } else {
                // 中文：先清除空格，再檢查完全相等
                return user.replace(/\s/g, '') === correct.replace(/\s/g, '');
            }
        }
        
        /**
         * 初始化事件監聽器
         */
        function setupListeners() {
            // 允許在輸入框中按 Enter 鍵觸發送出或下一題
            answerInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (!isQuestionAnswered) {
                        handleSubmitOrSkip();
                    } else {
                        nextQuestion();
                    }
                }
            });
        }

        // 應用程式啟動
        window.onload = function() {
            initApp();
        }
    </script>
</body>
</html>
